---
/**
 * Google Analytics (GA4) Integration
 *
 * To use:
 * 1. Go to analytics.google.com and create a GA4 property
 * 2. Get your Measurement ID (looks like G-XXXXXXXXXX)
 * 3. Set environment variable: PUBLIC_GA_MEASUREMENT_ID=G-XXXXXXXXXX
 */

const gaMeasurementId = import.meta.env.PUBLIC_GA_MEASUREMENT_ID;
const isDev = import.meta.env.DEV;
---

{gaMeasurementId && !isDev && (
  <>
    <script async src={`https://www.googletagmanager.com/gtag/js?id=${gaMeasurementId}`}></script>
    <script is:inline define:vars={{ gaMeasurementId }}>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', gaMeasurementId);
    </script>
  </>
)}

{/* Web Vitals tracking - only in production */}
{!isDev && (
  <script>
    // Core Web Vitals tracking
    // Reports CLS, INP, LCP metrics
    import('web-vitals').then(({ onCLS, onINP, onLCP }) => {
      const reportMetric = (metric) => {
        // Log to console in dev, send to Umami in production
        if (typeof umami !== 'undefined') {
          umami.track('web-vital', {
            name: metric.name,
            value: Math.round(metric.value),
            rating: metric.rating,
          });
        }
      };

      onCLS(reportMetric);
      onINP(reportMetric);
      onLCP(reportMetric);
    }).catch(() => {
      // web-vitals not available, skip
    });
  </script>
)}
