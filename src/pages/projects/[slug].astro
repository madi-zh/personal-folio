---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const { Content } = await project.render();
---

<Layout title={`${project.data.title} | Madi Zhanbyrtayev`} description={project.data.description}>
  <Header />
  <main class="pt-24 pb-16">
    <article class="max-w-3xl mx-auto px-6">
      <a
        href="/#projects"
        class="inline-flex items-center gap-2 text-sm text-text-secondary hover:text-accent transition-colors mb-8"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Back to Projects
      </a>

      <header class="mb-8">
        <h1 class="text-3xl font-bold text-text-primary mb-3">
          {project.data.title}
        </h1>
        <p class="text-lg text-text-secondary mb-4">
          {project.data.description}
        </p>
        <div class="flex flex-wrap items-center gap-4 text-sm text-text-secondary">
          <span class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            {project.data.role}
          </span>
          <span class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            {project.data.period}
          </span>
        </div>
      </header>

      {project.data.metrics && (
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-8">
          {project.data.metrics.commits && (
            <div class="p-4 bg-surface border border-border rounded-lg text-center">
              <div class="text-2xl font-bold text-accent">{project.data.metrics.commits}</div>
              <div class="text-xs text-text-secondary mt-1">Commits</div>
            </div>
          )}
          {project.data.metrics.contribution && (
            <div class="p-4 bg-surface border border-border rounded-lg text-center">
              <div class="text-2xl font-bold text-accent">{project.data.metrics.contribution}</div>
              <div class="text-xs text-text-secondary mt-1">Contribution</div>
            </div>
          )}
          {project.data.metrics.users && (
            <div class="p-4 bg-surface border border-border rounded-lg text-center">
              <div class="text-2xl font-bold text-accent">{project.data.metrics.users}</div>
              <div class="text-xs text-text-secondary mt-1">Users</div>
            </div>
          )}
          {project.data.metrics.impact && (
            <div class="p-4 bg-surface border border-border rounded-lg text-center">
              <div class="text-2xl font-bold text-accent">{project.data.metrics.impact}</div>
              <div class="text-xs text-text-secondary mt-1">Impact</div>
            </div>
          )}
        </div>
      )}

      <div class="mb-8">
        <h2 class="text-sm font-medium text-text-primary mb-3">Key Highlights</h2>
        <ul class="space-y-2">
          {project.data.highlights.map((highlight) => (
            <li class="text-sm text-text-secondary flex items-start gap-2">
              <span class="text-accent mt-0.5">▹</span>
              <span>{highlight}</span>
            </li>
          ))}
        </ul>
      </div>

      <div class="mb-8">
        <h2 class="text-sm font-medium text-text-primary mb-3">Tech Stack</h2>
        <div class="flex flex-wrap gap-2">
          {project.data.tech.map((tech) => (
            <span class="text-sm px-3 py-1 bg-surface text-text-secondary rounded-full border border-border">
              {tech}
            </span>
          ))}
        </div>
      </div>

      <div class="prose prose-invert max-w-none">
        <Content />
      </div>
    </article>
  </main>
  <Footer />
</Layout>

<style is:global>
  .prose {
    color: var(--text-secondary);
  }
  .prose h2 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
  .prose h3 {
    font-size: 1.125rem;
    font-weight: 500;
    color: var(--text-primary);
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
  }
  .prose p {
    margin-bottom: 1rem;
    line-height: 1.625;
  }
  .prose ul {
    list-style: none;
    margin-bottom: 1rem;
    padding: 0;
  }
  .prose ul li {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }
  .prose ul li::before {
    content: "▹";
    color: var(--accent);
    margin-top: 0.125rem;
    flex-shrink: 0;
  }
  .prose strong {
    color: var(--text-primary);
    font-weight: 500;
  }
  .prose code {
    background-color: var(--surface);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }
</style>
